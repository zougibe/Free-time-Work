<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
        Kinetic Typography Designer | Create Stunning Text Animations
    </title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        primary: {
                            500: "#6366f1",
                            600: "#4f46e5",
                        },
                        secondary: {
                            500: "#ec4899",
                            600: "#db2777",
                        },
                    },
                    animation: {
                        "pulse-slow":
                            "pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite",
                        float: "float 6s ease-in-out infinite",
                    },
                    keyframes: {
                        float: {
                            "0%, 100%": { transform: "translateY(0)" },
                            "50%": { transform: "translateY(-10px)" },
                        },
                    },
                },
            },
        };
    </script>
    <!-- p5.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <style>
        @import url("https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap");

        body {
            font-family: "Poppins", sans-serif;
        }

        .drag-item {
            cursor: grab;
            transition: all 0.2s;
            user-select: none;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .drag-item:active {
            cursor: grabbing;
            transform: scale(0.98);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        .droppable {
            transition: all 0.3s;
            border: 2px dashed transparent;
        }

        .droppable.highlight {
            border-color: #6366f1;
            background-color: rgba(99, 102, 241, 0.05);
        }

        #preview-container {
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
            border-radius: 12px;
        }

        #animation-canvas {
            width: 100%;
            height: 100%;
        }

        .tooltip {
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 50;
        }

        .has-tooltip:hover .tooltip {
            visibility: visible;
            opacity: 1;
        }

        .progress-ring__circle {
            transition: stroke-dashoffset 0.5s;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
        }

        .asset-card {
            transition: all 0.3s ease;
        }

        .asset-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .platform-tab {
            transition: all 0.3s ease;
        }

        .platform-tab.active {
            background-color: #6366f1;
            color: white;
        }

        .platform-tab:not(.active):hover {
            background-color: #f1f1f1;
        }

        .dark .platform-tab:not(.active):hover {
            background-color: #374151;
        }

        .animate-float {
            animation: float 6s ease-in-out infinite;
        }
    </style>
</head>

<body class="bg-gray-50 dark:bg-gray-900 text-gray-800 dark:text-gray-200 transition-colors duration-300">
    <!-- Loading Screen -->
    <div id="loading-screen"
        class="fixed inset-0 bg-white dark:bg-gray-900 z-50 flex flex-col items-center justify-center transition-opacity duration-500">
        <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-primary-500 mb-4"></div>
        <h2 class="text-xl font-semibold">Loading Designer</h2>
        <p class="text-gray-500 dark:text-gray-400">
            Preparing your creative tools...
        </p>
    </div>

    <!-- Main App -->
    <div id="app" class="opacity-0 transition-opacity duration-500">
        <!-- Header -->
        <header class="bg-white dark:bg-gray-800 shadow-sm">
            <div class="container mx-auto px-4 py-4 flex justify-between items-center">
                <div class="flex items-center space-x-2">
                    <div class="bg-primary-500 text-white p-2 rounded-lg">
                        <i class="fas fa-film text-xl"></i>
                    </div>
                    <h1
                        class="text-2xl font-bold bg-gradient-to-r from-primary-500 to-secondary-500 bg-clip-text text-transparent">
                        KineticType
                    </h1>
                </div>

                <div class="flex items-center space-x-4">
                    <div class="relative has-tooltip">
                        <span
                            class="tooltip absolute -top-10 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white text-xs py-1 px-2 rounded whitespace-nowrap">Try
                            Trending: Neon Glitch</span>
                        <button id="trending-btn"
                            class="p-2 rounded-full bg-gradient-to-r from-secondary-500 to-primary-500 text-white shadow-lg hover:shadow-xl transition-shadow">
                            <i class="fas fa-bolt"></i>
                        </button>
                    </div>

                    <button id="theme-toggle"
                        class="p-2 rounded-full bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                        <i id="theme-icon" class="fas fa-sun"></i>
                    </button>

                    <button id="help-btn"
                        class="p-2 rounded-full bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                        <i class="fas fa-question"></i>
                    </button>
                </div>
            </div>
        </header>

        <div class="container mx-auto px-4 py-8">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                <!-- Left Panel - Assets -->
                <div class="lg:col-span-1 bg-white dark:bg-gray-800 rounded-xl shadow-md p-6">
                    <h2 class="text-xl font-semibold mb-6 flex items-center">
                        <i class="fas fa-palette mr-2 text-primary-500"></i>
                        Design Assets
                    </h2>

                    <div class="mb-8">
                        <h3 class="font-medium mb-3 flex items-center">
                            <i class="fas fa-mobile-screen mr-2 text-gray-500 dark:text-gray-400"></i>
                            Platform
                        </h3>
                        <div class="flex rounded-lg overflow-hidden border dark:border-gray-700">
                            <button data-platform="instagram"
                                class="platform-tab active flex-1 py-2 px-3 text-sm font-medium">
                                <i class="fab fa-instagram mr-1"></i> IG
                            </button>
                            <button data-platform="tiktok" class="platform-tab flex-1 py-2 px-3 text-sm font-medium">
                                <i class="fab fa-tiktok mr-1"></i> TikTok
                            </button>
                            <button data-platform="youtube" class="platform-tab flex-1 py-2 px-3 text-sm font-medium">
                                <i class="fab fa-youtube mr-1"></i> YouTube
                            </button>
                        </div>
                    </div>

                    <div class="mb-8">
                        <h3 class="font-medium mb-3 flex items-center">
                            <i class="fas fa-font mr-2 text-gray-500 dark:text-gray-400"></i>
                            Text Content
                        </h3>
                        <textarea id="text-content"
                            class="w-full p-3 border rounded-lg dark:bg-gray-700 dark:border-gray-600 focus:ring-2 focus:ring-primary-500 focus:border-transparent"
                            rows="3" placeholder="Type your message here..."></textarea>
                        <div class="flex justify-between items-center mt-2">
                            <span id="char-count" class="text-xs text-gray-500 dark:text-gray-400">0/120</span>
                            <button id="update-text"
                                class="bg-primary-500 hover:bg-primary-600 text-white py-1 px-4 rounded-lg text-sm font-medium transition-colors flex items-center">
                                <i class="fas fa-sync-alt mr-1"></i> Update
                            </button>
                        </div>
                    </div>

                    <div class="mb-8">
                        <h3 class="font-medium mb-3 flex items-center justify-between">
                            <span><i class="fas fa-text-height mr-2 text-gray-500 dark:text-gray-400"></i>Fonts</span>
                            <button id="random-font" class="text-xs text-primary-500 hover:text-primary-600">
                                <i class="fas fa-random mr-1"></i>Random
                            </button>
                        </h3>
                        <div id="fonts-container" class="grid grid-cols-2 gap-3">
                            <!-- Fonts will be populated by JS -->
                        </div>
                    </div>

                    <div class="mb-8">
                        <h3 class="font-medium mb-3 flex items-center justify-between">
                            <span><i class="fas fa-magic mr-2 text-gray-500 dark:text-gray-400"></i>Motion
                                Effects</span>
                            <button id="random-effect" class="text-xs text-primary-500 hover:text-primary-600">
                                <i class="fas fa-random mr-1"></i>Random
                            </button>
                        </h3>
                        <div id="effects-container" class="grid grid-cols-2 gap-3">
                            <!-- Effects will be populated by JS -->
                        </div>
                    </div>

                    <div class="mb-4">
                        <h3 class="font-medium mb-3 flex items-center justify-between">
                            <span><i class="fas fa-fill-drip mr-2 text-gray-500 dark:text-gray-400"></i>Color
                                Schemes</span>
                            <button id="random-color" class="text-xs text-primary-500 hover:text-primary-600">
                                <i class="fas fa-random mr-1"></i>Random
                            </button>
                        </h3>
                        <div id="colors-container" class="grid grid-cols-3 gap-3">
                            <!-- Colors will be populated by JS -->
                        </div>
                    </div>
                </div>

                <!-- Center Panel - Canvas -->
                <div class="lg:col-span-2">
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6 mb-6">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-xl font-semibold flex items-center">
                                <i class="fas fa-play-circle mr-2 text-primary-500"></i>
                                Animation Preview
                            </h2>
                            <div class="flex items-center space-x-2">
                                <button id="play-pause-btn"
                                    class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                                    <i class="fas fa-pause"></i>
                                </button>
                                <button id="reset-animation-btn"
                                    class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                                    <i class="fas fa-redo"></i>
                                </button>
                            </div>
                        </div>

                        <div id="preview-container"
                            class="relative bg-gray-100 dark:bg-gray-700 rounded-xl overflow-hidden mx-auto droppable"
                            style="max-height: 80vh; aspect-ratio: 9 / 16">
                            <div id="animation-canvas"></div>
                            <div id="drop-hint"
                                class="absolute inset-0 flex items-center justify-center pointer-events-none opacity-0 transition-opacity">
                                <div
                                    class="bg-primary-500 bg-opacity-10 border-2 border-primary-500 border-dashed rounded-xl p-8 text-center w-4/5">
                                    <i class="fas fa-arrow-down text-primary-500 text-3xl mb-2 animate-float"></i>
                                    <p class="text-primary-500 font-medium">
                                        Drop assets here to apply
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6">
                        <div class="flex justify-center space-x-4">
                            <button id="save-btn"
                                class="bg-primary-500 hover:bg-primary-600 text-white py-3 px-6 rounded-lg font-medium transition-colors flex items-center shadow-md hover:shadow-lg">
                                <i class="fas fa-save mr-2"></i>
                                Save Design
                            </button>
                            <button id="export-gif-btn"
                                class="bg-secondary-500 hover:bg-secondary-600 text-white py-3 px-6 rounded-lg font-medium transition-colors flex items-center shadow-md hover:shadow-lg">
                                <i class="fas fa-file-export mr-2"></i>
                                Export GIF
                            </button>
                            <button id="clear-btn"
                                class="bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-200 py-3 px-6 rounded-lg font-medium transition-colors flex items-center">
                                <i class="fas fa-trash-alt mr-2"></i>
                                Clear
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Right Panel - Engagement & Saved -->
                <div class="lg:col-span-1 bg-white dark:bg-gray-800 rounded-xl shadow-md p-6">
                    <div class="mb-8">
                        <h2 class="text-xl font-semibold mb-4 flex items-center">
                            <i class="fas fa-chart-line mr-2 text-primary-500"></i>
                            Engagement Score
                        </h2>
                        <div class="bg-gray-50 dark:bg-gray-700 rounded-xl p-5">
                            <div class="flex justify-center mb-6">
                                <div class="relative w-32 h-32">
                                    <svg class="w-full h-full" viewBox="0 0 100 100">
                                        <circle class="text-gray-200 dark:text-gray-600" stroke-width="8"
                                            stroke="currentColor" fill="transparent" r="40" cx="50" cy="50" />
                                        <circle class="progress-ring__circle text-primary-500" stroke-width="8"
                                            stroke-dasharray="251.2" stroke-dashoffset="0" stroke-linecap="round"
                                            stroke="currentColor" fill="transparent" r="40" cx="50" cy="50" />
                                    </svg>
                                    <div class="absolute inset-0 flex flex-col items-center justify-center">
                                        <span id="total-score"
                                            class="text-3xl font-bold bg-gradient-to-r from-primary-500 to-secondary-500 bg-clip-text text-transparent">0</span>
                                        <span class="text-xs text-gray-500 dark:text-gray-400">OUT OF 100</span>
                                    </div>
                                </div>
                            </div>

                            <div class="space-y-3">
                                <div>
                                    <div class="flex justify-between items-center mb-1">
                                        <span class="text-sm font-medium">Fluidity</span>
                                        <span id="fluidity-score" class="text-sm font-bold">0</span>
                                    </div>
                                    <div class="w-full bg-gray-200 dark:bg-gray-600 rounded-full h-2">
                                        <div id="fluidity-bar" class="bg-blue-500 h-2 rounded-full" style="width: 0%">
                                        </div>
                                    </div>
                                </div>

                                <div>
                                    <div class="flex justify-between items-center mb-1">
                                        <span class="text-sm font-medium">Visual Impact</span>
                                        <span id="impact-score" class="text-sm font-bold">0</span>
                                    </div>
                                    <div class="w-full bg-gray-200 dark:bg-gray-600 rounded-full h-2">
                                        <div id="impact-bar" class="bg-purple-500 h-2 rounded-full" style="width: 0%">
                                        </div>
                                    </div>
                                </div>

                                <div>
                                    <div class="flex justify-between items-center mb-1">
                                        <span class="text-sm font-medium">Platform Fit</span>
                                        <span id="platform-score" class="text-sm font-bold">0</span>
                                    </div>
                                    <div class="w-full bg-gray-200 dark:bg-gray-600 rounded-full h-2">
                                        <div id="platform-bar" class="bg-green-500 h-2 rounded-full" style="width: 0%">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <p id="score-feedback" class="mt-4 text-sm text-center text-gray-600 dark:text-gray-300">
                                Start designing to see your score!
                            </p>
                        </div>
                    </div>

                    <div>
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-xl font-semibold flex items-center">
                                <i class="fas fa-folder-open mr-2 text-primary-500"></i>
                                Saved Designs
                            </h2>
                            <button id="clear-saved-btn" class="text-xs text-red-500 hover:text-red-600">
                                <i class="fas fa-trash-alt mr-1"></i>Clear
                                All
                            </button>
                        </div>

                        <div id="saved-designs" class="space-y-3 max-h-96 overflow-y-auto pr-2">
                            <!-- Saved designs will be populated by JS -->
                            <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 text-center">
                                <i class="fas fa-folder-open text-gray-400 text-2xl mb-2"></i>
                                <p class="text-gray-500 dark:text-gray-400 text-sm">
                                    No saved designs yet
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tutorial Modal -->
        <div id="tutorial-modal"
            class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center opacity-0 pointer-events-none transition-opacity duration-300">
            <div
                class="bg-white dark:bg-gray-800 rounded-xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto transform transition-all duration-300 scale-95">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold">
                            Welcome to KineticType!
                        </h3>
                        <button id="close-tutorial" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>

                    <div class="space-y-4">
                        <div class="flex items-start">
                            <div
                                class="bg-primary-100 dark:bg-primary-900 text-primary-500 dark:text-primary-300 rounded-full p-2 mr-3 flex-shrink-0">
                                <i class="fas fa-drag-drop"></i>
                            </div>
                            <div>
                                <h4 class="font-medium mb-1">
                                    Drag & Drop Design
                                </h4>
                                <p class="text-gray-600 dark:text-gray-300 text-sm">
                                    Simply drag fonts, effects and colors
                                    onto the preview area to create your
                                    animation.
                                </p>
                            </div>
                        </div>

                        <div class="flex items-start">
                            <div
                                class="bg-primary-100 dark:bg-primary-900 text-primary-500 dark:text-primary-300 rounded-full p-2 mr-3 flex-shrink-0">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <div>
                                <h4 class="font-medium mb-1">
                                    Engagement Score
                                </h4>
                                <p class="text-gray-600 dark:text-gray-300 text-sm">
                                    Our algorithm rates your design based on
                                    visual impact and platform optimization.
                                </p>
                            </div>
                        </div>

                        <div class="flex items-start">
                            <div
                                class="bg-primary-100 dark:bg-primary-900 text-primary-500 dark:text-primary-300 rounded-full p-2 mr-3 flex-shrink-0">
                                <i class="fas fa-random"></i>
                            </div>
                            <div>
                                <h4 class="font-medium mb-1">
                                    Randomize Elements
                                </h4>
                                <p class="text-gray-600 dark:text-gray-300 text-sm">
                                    Click the random buttons to quickly
                                    experiment with different combinations.
                                </p>
                            </div>
                        </div>

                        <div class="flex items-start">
                            <div
                                class="bg-primary-100 dark:bg-primary-900 text-primary-500 dark:text-primary-300 rounded-full p-2 mr-3 flex-shrink-0">
                                <i class="fas fa-save"></i>
                            </div>
                            <div>
                                <h4 class="font-medium mb-1">
                                    Save & Export
                                </h4>
                                <p class="text-gray-600 dark:text-gray-300 text-sm">
                                    Save your designs locally or export as
                                    GIF to use on social media.
                                </p>
                            </div>
                        </div>
                    </div>

                    <div class="mt-6 pt-4 border-t border-gray-200 dark:border-gray-700">
                        <button id="got-it-btn"
                            class="w-full bg-primary-500 hover:bg-primary-600 text-white py-2 rounded-lg font-medium transition-colors">
                            Got It, Let's Start!
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Enhanced dataset for assets
        const assets = {
            fonts: [
                {
                    id: "font1",
                    name: "Bold Modern",
                    value: 'bold 48px "Poppins", sans-serif',
                    preview: "font-bold",
                    category: "modern",
                },
                {
                    id: "font2",
                    name: "Playful",
                    value: 'italic 36px "Comic Sans MS", cursive',
                    preview: "italic",
                    category: "fun",
                },
                {
                    id: "font3",
                    name: "Elegant Serif",
                    value: 'normal 42px "Times New Roman", serif',
                    preview: "font-serif",
                    category: "elegant",
                },
                {
                    id: "font4",
                    name: "Minimal",
                    value: '500 40px "Helvetica Neue", sans-serif',
                    preview: "font-medium",
                    category: "modern",
                },
                {
                    id: "font5",
                    name: "Handwritten",
                    value: 'normal 38px "Brush Script MT", cursive',
                    preview: "italic",
                    category: "fun",
                },
                {
                    id: "font6",
                    name: "Futuristic",
                    value: 'bold 44px "Courier New", monospace',
                    preview: "font-bold",
                    category: "modern",
                },
                {
                    id: "font7",
                    name: "Retro",
                    value: 'normal 40px "Impact", sans-serif',
                    preview: "font-bold",
                    category: "fun",
                },
                {
                    id: "font8",
                    name: "Sophisticated",
                    value: '500 38px "Garamond", serif',
                    preview: "font-medium",
                    category: "elegant",
                },
            ],
            effects: [
                {
                    id: "effect1",
                    name: "Bounce",
                    type: "motion",
                    intensity: "medium",
                },
                {
                    id: "effect2",
                    name: "Fade In",
                    type: "transition",
                    intensity: "low",
                },
                {
                    id: "effect3",
                    name: "Spin",
                    type: "motion",
                    intensity: "high",
                },
                {
                    id: "effect4",
                    name: "Wave",
                    type: "motion",
                    intensity: "medium",
                },
                {
                    id: "effect5",
                    name: "Typewriter",
                    type: "transition",
                    intensity: "low",
                },
                {
                    id: "effect6",
                    name: "Glitch",
                    type: "transition",
                    intensity: "high",
                },
                {
                    id: "effect7",
                    name: "Float",
                    type: "motion",
                    intensity: "low",
                },
                {
                    id: "effect8",
                    name: "Pulse",
                    type: "motion",
                    intensity: "medium",
                },
            ],
            colors: [
                {
                    id: "color1",
                    name: "Vibrant",
                    bg: "bg-gradient-to-r from-pink-500 to-yellow-500",
                    text: "text-white",
                    mood: "energetic",
                },
                {
                    id: "color2",
                    name: "Dark",
                    bg: "bg-gray-900",
                    text: "text-white",
                    mood: "serious",
                },
                {
                    id: "color3",
                    name: "Light",
                    bg: "bg-white",
                    text: "text-gray-900",
                    mood: "clean",
                },
                {
                    id: "color4",
                    name: "Ocean",
                    bg: "bg-gradient-to-r from-blue-500 to-teal-400",
                    text: "text-white",
                    mood: "calm",
                },
                {
                    id: "color5",
                    name: "Sunset",
                    bg: "bg-gradient-to-r from-purple-500 to-red-500",
                    text: "text-white",
                    mood: "warm",
                },
                {
                    id: "color6",
                    name: "Neon",
                    bg: "bg-gradient-to-r from-green-400 to-blue-500",
                    text: "text-white",
                    mood: "vibrant",
                },
                {
                    id: "color7",
                    name: "Pastel",
                    bg: "bg-gradient-to-r from-pink-300 to-purple-300",
                    text: "text-gray-900",
                    mood: "soft",
                },
                {
                    id: "color8",
                    name: "Fire",
                    bg: "bg-gradient-to-r from-red-500 to-orange-500",
                    text: "text-white",
                    mood: "intense",
                },
            ],
            platforms: {
                instagram: {
                    aspectRatio: 4 / 5,
                    idealTextLength: 100,
                    idealEffects: ["Fade In", "Wave", "Float"],
                    idealFonts: ["modern", "elegant"],
                    idealColors: ["energetic", "warm"],
                },
                tiktok: {
                    aspectRatio: 9 / 16,
                    idealTextLength: 50,
                    idealEffects: ["Bounce", "Glitch", "Pulse"],
                    idealFonts: ["fun", "modern"],
                    idealColors: ["vibrant", "intense"],
                },
                youtube: {
                    aspectRatio: 16 / 9,
                    idealTextLength: 150,
                    idealEffects: ["Typewriter", "Spin", "Wave"],
                    idealFonts: ["modern", "elegant"],
                    idealColors: ["serious", "calm"],
                },
            },
        };

        // Current design state
        let currentDesign = {
            platform: "instagram",
            text: "Create Amazing\nTypography!",
            font: 'bold 48px "Poppins", sans-serif',
            effect: "bounce",
            bgColor: "bg-gradient-to-r from-pink-500 to-yellow-500",
            textColor: "text-white",
            animationParams: {},
        };

        // p5.js sketch
        let sketch = function (p) {
            let time = 0;
            let textX, textY;
            let fontSize = 48;
            let typewriterIndex = 0;
            let typewriterText = "";
            let glitchOffset = 0;
            let isPlaying = true;
            let bgGraphics;
            let isCanvasInitialized = false;

            p.setup = function () {
                try {
                    let canvas = p.createCanvas(500, 500);
                    if (!canvas || !canvas.elt) {
                        throw new Error("Canvas creation failed");
                    }
                    canvas.parent("animation-canvas");
                    p.textAlign(p.CENTER, p.CENTER);
                    p.textSize(myp5.fontSize || 48);
                    textX = p.width / 2;
                    textY = p.height / 2;

                    // Create off-screen graphics for background
                    bgGraphics = p.createGraphics(p.width, p.height);
                    if (!bgGraphics) {
                        throw new Error(
                            "Background graphics creation failed"
                        );
                    }

                    // Set initial background
                    updateCanvasBackground();

                    isCanvasInitialized = true;
                    console.debug(
                        "p5.js setup completed: Canvas initialized"
                    );
                } catch (e) {
                    console.error("p5.js setup failed:", e);
                    isCanvasInitialized = false;
                }
            };

            p.draw = function () {
                try {
                    if (!isCanvasInitialized) {
                        console.warn(
                            "Canvas not initialized, skipping draw"
                        );
                        return;
                    }
                    if (!isPlaying) {
                        console.debug("Animation paused, skipping draw");
                        return;
                    }

                    // Validate canvas
                    if (!p.canvas || !p.width || !p.height) {
                        throw new Error("Invalid canvas state");
                    }
                    console.debug("Draw: Validated canvas");

                    time += 0.05;

                    // Apply background
                    try {
                        if (currentDesign.bgColor.includes("gradient")) {
                            p.image(bgGraphics, 0, 0);
                            console.debug(
                                "Draw: Gradient background applied"
                            );
                        } else {
                            p.background(
                                getColorValue(currentDesign.bgColor)
                            );
                            console.debug("Draw: Solid background applied");
                        }
                    } catch (e) {
                        throw new Error(
                            `Failed to set background: ${e.message}`
                        );
                    }

                    // Validate design state
                    if (
                        !currentDesign.text ||
                        typeof currentDesign.text !== "string"
                    ) {
                        currentDesign.text = "Your Text Here";
                        console.warn(
                            "Invalid text, using default 'Your Text Here'"
                        );
                    }
                    console.debug(
                        `Draw: Text content: '${currentDesign.text}'`
                    );

                    // Apply text effect
                    p.push();
                    try {
                        applyTextEffect();
                        console.debug("Draw: Text effect applied");
                    } catch (e) {
                        throw new Error(
                            `Failed to apply text effect: ${e.message}`
                        );
                    }

                    // Set text color
                    try {
                        p.fill(getColorValue(currentDesign.textColor));
                        console.debug(
                            `Draw: Text color set to ${currentDesign.textColor}`
                        );
                    } catch (e) {
                        throw new Error(
                            `Failed to set text color: ${e.message}`
                        );
                    }

                    // Extract and validate font properties
                    let weight, size, family;
                    try {
                        const fontParts = currentDesign.font.split(" ");
                        weight = fontParts[0];
                        size = fontParts[1];
                        family = fontParts
                            .slice(2)
                            .join(" ")
                            .replace(/"/g, "");
                        if (!family || !size || isNaN(parseInt(size))) {
                            throw new Error("Invalid font format");
                        }
                        console.debug(
                            `Draw: Parsed font - Weight: ${weight}, Size: ${size}, Family: ${family}`
                        );
                    } catch (e) {
                        console.warn(
                            `Font parsing failed: ${e.message}, using fallback`
                        );
                        weight = "normal";
                        size = "48px";
                        family = "Arial";
                    }

                    // Apply font
                    try {
                        p.textSize(
                            Math.max(10, Math.min(100, parseInt(size)))
                        );
                        try {
                            p.textFont(family);
                            console.debug(`Draw: Font set to ${family}`);
                        } catch (e) {
                            console.warn(
                                `Failed to set font ${family}: ${e.message}, falling back to Arial`
                            );
                            p.textFont("Arial");
                            console.debug(
                                "Draw: Font set to Arial (fallback)"
                            );
                        }
                        p.textStyle(
                            weight === "bold"
                                ? p.BOLD
                                : weight === "italic"
                                    ? p.ITALIC
                                    : p.NORMAL
                        );
                        console.debug(`Draw: Text style set to ${weight}`);
                    } catch (e) {
                        throw new Error(
                            `Failed to apply font: ${e.message}`
                        );
                    }

                    // Calculate text position with line breaks
                    const lines = currentDesign.text.split("\n");
                    const lineHeight = p.textSize() * 1.2;
                    const startY =
                        textY - ((lines.length - 1) * lineHeight) / 2;

                    // Validate text position
                    if (isNaN(textX) || isNaN(textY)) {
                        textX = p.width / 2;
                        textY = p.height / 2;
                        console.warn(
                            "Invalid text position, resetting to center"
                        );
                    }
                    console.debug(
                        `Draw: Text position - x: ${textX}, y: ${startY}, lines: ${lines.length}`
                    );

                    // Draw each line of text
                    try {
                        for (let i = 0; i < lines.length; i++) {
                            let yPos = startY + i * lineHeight;
                            if (yPos < -p.height || yPos > 2 * p.height) {
                                console.warn(
                                    `Line ${i} out of bounds: y=${yPos}`
                                );
                                continue;
                            }
                            p.text(lines[i], textX, yPos);
                            console.debug(
                                `Draw: Rendered line ${i}: '${lines[i]}' at x=${textX}, y=${yPos}`
                            );
                        }
                    } catch (e) {
                        throw new Error(
                            `Failed to render text: ${e.message}`
                        );
                    }

                    p.pop();

                    // Update engagement score
                    try {
                        updateEngagementScore();
                        console.debug("Draw: Engagement score updated");
                    } catch (e) {
                        console.warn(
                            `Engagement score update failed: ${e.message}`
                        );
                    }
                } catch (e) {
                    console.error("Draw failed:", e);
                }
            };

            function updateCanvasBackground() {
                try {
                    if (currentDesign.bgColor.includes("gradient")) {
                        let gradientColors = currentDesign.bgColor.match(
                            /from-(.*?) to-(.*?)( |$)/
                        );
                        if (gradientColors) {
                            let fromColor =
                                gradientColors[1].replace(/\d+/g, "") +
                                "-500";
                            let toColor =
                                gradientColors[2].replace(/\d+/g, "") +
                                "-500";

                            bgGraphics.clear();
                            for (let y = 0; y < bgGraphics.height; y++) {
                                let inter = p.map(
                                    y,
                                    0,
                                    bgGraphics.height,
                                    0,
                                    1
                                );
                                let c = p.lerpColor(
                                    getP5Color(fromColor),
                                    getP5Color(toColor),
                                    inter
                                );
                                bgGraphics.stroke(c);
                                bgGraphics.line(0, y, bgGraphics.width, y);
                            }
                            console.debug("Background: Gradient updated");
                        } else {
                            console.warn(
                                "Invalid gradient format, using default"
                            );
                        }
                    }
                } catch (e) {
                    console.error(
                        `Failed to update background: ${e.message}`
                    );
                }
            }

            function getP5Color(tailwindClass) {
                try {
                    let colorName = tailwindClass.split("-")[0];
                    let shade = tailwindClass.split("-")[1] || "500";

                    const colors = {
                        pink: { 500: "#EC4899", 300: "#F9A8D4" },
                        yellow: { 500: "#EAB308" },
                        gray: {
                            900: "#111827",
                            700: "#374151",
                            200: "#E5E7EB",
                        },
                        white: { default: "#FFFFFF" },
                        blue: {
                            500: "#3B82F6",
                            400: "#60A5FA",
                            300: "#93C5FD",
                        },
                        teal: { 400: "#2DD4BF" },
                        purple: { 500: "#A855F7", 300: "#D8B4FE" },
                        red: { 500: "#EF4444" },
                        orange: { 500: "#F97316" },
                        green: { 400: "#4ADE80", 500: "#10B981" },
                    };

                    let hex =
                        colors[colorName]?.[shade] ||
                        colors[colorName]?.default ||
                        "#FFFFFF";
                    return p.color(hex);
                } catch (e) {
                    console.warn(
                        `Failed to get color ${tailwindClass}: ${e.message}, using #FFFFFF`
                    );
                    return p.color("#FFFFFF");
                }
            }

            function applyTextEffect() {
                try {
                    switch (currentDesign.effect) {
                        case "bounce":
                            let bounceY = p.sin(time * 2) * 20;
                            p.translate(0, bounceY);
                            console.debug(
                                `Effect: Bounce, y-offset: ${bounceY}`
                            );
                            break;
                        case "fade-in":
                            let alpha = p.map(
                                p.constrain(time, 0, 2),
                                0,
                                2,
                                0,
                                255
                            );
                            p.fill(
                                p.red(p.fill()),
                                p.green(p.fill()),
                                p.blue(p.fill()),
                                alpha
                            );
                            console.debug(
                                `Effect: Fade-in, alpha: ${alpha}`
                            );
                            break;
                        case "spin":
                            p.translate(textX, textY);
                            p.rotate(time);
                            p.translate(-textX, -textY);
                            console.debug("Effect: Spin, rotation applied");
                            break;
                        case "wave":
                            p.translate(
                                0,
                                p.sin(time * 3 + textX * 0.01) * 10
                            );
                            console.debug(
                                "Effect: Wave, translation applied"
                            );
                            break;
                        case "typewriter":
                            if (
                                typewriterIndex < currentDesign.text.length
                            ) {
                                typewriterIndex += 0.5;
                            }
                            typewriterText = currentDesign.text.substring(
                                0,
                                Math.floor(typewriterIndex)
                            );
                            console.debug(
                                `Effect: Typewriter, index: ${typewriterIndex}, text: '${typewriterText}'`
                            );
                            break;
                        case "glitch":
                            if (p.frameCount % 10 === 0) {
                                glitchOffset = p.random(-5, 5);
                            }
                            p.translate(glitchOffset, 0);
                            console.debug(
                                `Effect: Glitch, offset: ${glitchOffset}`
                            );
                            break;
                        case "float":
                            p.translate(0, p.sin(time * 1.5) * 8);
                            console.debug(
                                "Effect: Float, translation applied"
                            );
                            break;
                        case "pulse":
                            let scale = 1 + p.sin(time * 2) * 0.1;
                            p.translate(textX, textY);
                            p.scale(scale);
                            p.translate(-textX, -textY);
                            console.debug(`Effect: Pulse, scale: ${scale}`);
                            break;
                        default:
                            console.warn(
                                `Unknown effect: ${currentDesign.effect}`
                            );
                    }
                } catch (e) {
                    throw new Error(
                        `Effect ${currentDesign.effect} failed: ${e.message}`
                    );
                }
            }

            this.togglePlayback = function () {
                isPlaying = !isPlaying;
                console.debug(
                    `Playback toggled: ${isPlaying ? "Playing" : "Paused"}`
                );
                return isPlaying;
            };

            this.resetAnimation = function () {
                time = 0;
                typewriterIndex = 0;
                typewriterText = "";
                glitchOffset = 0;
                console.debug("Animation reset");
            };
        };

        // Initialize p5 sketch
        let myp5 = new p5(sketch);

        // DOM elements
        const loadingScreen = document.getElementById("loading-screen");
        const app = document.getElementById("app");
        const textContent = document.getElementById("text-content");
        const charCount = document.getElementById("char-count");
        const updateTextBtn = document.getElementById("update-text");
        const fontsContainer = document.getElementById("fonts-container");
        const effectsContainer =
            document.getElementById("effects-container");
        const colorsContainer = document.getElementById("colors-container");
        const saveBtn = document.getElementById("save-btn");
        const exportGifBtn = document.getElementById("export-gif-btn");
        const clearBtn = document.getElementById("clear-btn");
        const playPauseBtn = document.getElementById("play-pause-btn");
        const resetAnimationBtn = document.getElementById(
            "reset-animation-btn"
        );
        const savedDesigns = document.getElementById("saved-designs");
        const clearSavedBtn = document.getElementById("clear-saved-btn");
        const themeToggle = document.getElementById("theme-toggle");
        const themeIcon = document.getElementById("theme-icon");
        const trendingBtn = document.getElementById("trending-btn");
        const helpBtn = document.getElementById("help-btn");
        const tutorialModal = document.getElementById("tutorial-modal");
        const closeTutorial = document.getElementById("close-tutorial");
        const gotItBtn = document.getElementById("got-it-btn");
        const randomFontBtn = document.getElementById("random-font");
        const randomEffectBtn = document.getElementById("random-effect");
        const randomColorBtn = document.getElementById("random-color");
        const platformTabs = document.querySelectorAll(".platform-tab");
        const dropHint = document.getElementById("drop-hint");

        // Engagement score elements
        const fluidityScore = document.getElementById("fluidity-score");
        const impactScore = document.getElementById("impact-score");
        const platformScore = document.getElementById("platform-score");
        const totalScore = document.getElementById("total-score");
        const scoreFeedback = document.getElementById("score-feedback");
        const fluidityBar = document.getElementById("fluidity-bar");
        const impactBar = document.getElementById("impact-bar");
        const platformBar = document.getElementById("platform-bar");
        const progressRing = document.querySelector(
            ".progress-ring__circle"
        );
        const circumference = 2 * Math.PI * 40;

        // Initialize the app
        function initApp() {
            // Simulate loading
            setTimeout(() => {
                loadingScreen.style.opacity = "0";
                loadingScreen.style.pointerEvents = "none";
                app.style.opacity = "1";

                // Show tutorial on first visit
                if (!localStorage.getItem("kineticTypeTutorialShown")) {
                    setTimeout(() => {
                        showTutorial();
                        localStorage.setItem(
                            "kineticTypeTutorialShown",
                            "true"
                        );
                    }, 500);
                }
            }, 1500);

            // Load saved designs
            loadSavedDesigns();

            // Set initial text
            textContent.value = currentDesign.text;
            updateCharCount();

            // Populate asset panels
            populateFonts();
            populateEffects();
            populateColors();

            // Set up event listeners
            setupEventListeners();

            // Set initial platform
            updatePlatform("instagram");

            // Set initial theme
            if (
                localStorage.getItem("darkMode") === "true" ||
                (!localStorage.getItem("darkMode") &&
                    window.matchMedia("(prefers-color-scheme: dark)")
                        .matches)
            ) {
                enableDarkMode();
            } else {
                enableLightMode();
            }
        }

        // Set up event listeners
        function setupEventListeners() {
            // Text content
            textContent.addEventListener("input", updateCharCount);
            updateTextBtn.addEventListener("click", updateDesignText);

            // Platform tabs
            platformTabs.forEach((tab) => {
                tab.addEventListener("click", function () {
                    updatePlatform(this.dataset.platform);
                });
            });

            // Buttons
            saveBtn.addEventListener("click", saveDesign);
            exportGifBtn.addEventListener("click", exportAsGif);
            clearBtn.addEventListener("click", clearDesign);
            playPauseBtn.addEventListener("click", function () {
                const isPlaying = togglePlayback();
                this.innerHTML = `<i class="fas fa-${isPlaying ? "pause" : "play"
                    }"></i>`;
                console.debug(
                    `Play/Pause toggled: ${isPlaying ? "Playing" : "Paused"
                    }`
                );
            });
            resetAnimationBtn.addEventListener("click", function () {
                myp5.resetAnimation();
                showToast("Animation reset", "success");
                console.debug("Animation reset triggered");
            });
            clearSavedBtn.addEventListener("click", clearAllSavedDesigns);

            // Theme toggle
            themeToggle.addEventListener("click", toggleDarkMode);

            // Help and trending
            trendingBtn.addEventListener("click", applyTrendingStyle);
            helpBtn.addEventListener("click", showTutorial);
            closeTutorial.addEventListener("click", hideTutorial);
            gotItBtn.addEventListener("click", hideTutorial);

            // Randomizers
            randomFontBtn.addEventListener("click", randomizeFont);
            randomEffectBtn.addEventListener("click", randomizeEffect);
            randomColorBtn.addEventListener("click", randomizeColor);

            // Make assets draggable
            document.addEventListener("dragstart", function (e) {
                if (e.target.classList.contains("drag-item")) {
                    e.dataTransfer.setData("type", e.target.dataset.type);
                    e.dataTransfer.setData("value", e.target.dataset.value);
                    e.dataTransfer.setData("bg", e.target.dataset.bg || "");
                    e.dataTransfer.setData(
                        "text",
                        e.target.dataset.text || ""
                    );
                    e.dataTransfer.effectAllowed = "copy";

                    // Show drop hint
                    dropHint.style.opacity = "1";
                }
            });

            document.addEventListener("dragend", function () {
                // Hide drop hint
                dropHint.style.opacity = "0";
            });

            // Set up droppable canvas
            const canvasContainer =
                document.getElementById("preview-container");
            canvasContainer.addEventListener("dragover", function (e) {
                e.preventDefault();
                e.dataTransfer.dropEffect = "copy";
                this.classList.add("highlight");
            });

            canvasContainer.addEventListener("dragleave", function () {
                this.classList.remove("highlight");
            });

            canvasContainer.addEventListener("drop", function (e) {
                e.preventDefault();
                this.classList.remove("highlight");
                dropHint.style.opacity = "0";

                const type = e.dataTransfer.getData("type");
                const value = e.dataTransfer.getData("value");
                const bg = e.dataTransfer.getData("bg");
                const textColor = e.dataTransfer.getData("text");

                if (!type) return;

                // Add visual feedback
                const feedback = document.createElement("div");
                feedback.className =
                    "absolute inset-0 flex items-center justify-center pointer-events-none";
                feedback.innerHTML = `<div class="bg-white dark:bg-gray-800 rounded-full p-3 shadow-lg animate-ping-slow">
                    <i class="fas fa-check text-green-500 text-xl"></i>
                </div>`;
                this.appendChild(feedback);

                setTimeout(() => {
                    feedback.remove();
                }, 1000);

                switch (type) {
                    case "font":
                        currentDesign.font = value;
                        break;
                    case "effect":
                        currentDesign.effect = value
                            .toLowerCase()
                            .replace(" ", "-");
                        myp5.resetAnimation();
                        break;
                    case "color":
                        currentDesign.bgColor = bg;
                        currentDesign.textColor = textColor;
                        updateCanvasBackground();
                        break;
                }

                console.debug(
                    `Dropped asset: Type=${type}, Value=${value}`
                );
                updateEngagementScore();
            });
        }

        // Populate fonts
        function populateFonts() {
            fontsContainer.innerHTML = "";
            assets.fonts.forEach((font) => {
                const fontEl = document.createElement("div");
                fontEl.className = `drag-item asset-card p-3 border rounded-lg text-center cursor-move ${font.preview} dark:border-gray-600 hover:border-primary-500`;
                fontEl.innerHTML = `
                    <div class="text-lg mb-1">${font.name}</div>
                    <div class="text-xs text-gray-500 dark:text-gray-400">${font.value
                        .split(" ")
                        .slice(2)
                        .join(" ")
                        .replace(/"/g, "")}</div>
                `;
                fontEl.draggable = true;
                fontEl.dataset.type = "font";
                fontEl.dataset.value = font.value;
                fontEl.dataset.id = font.id;
                fontsContainer.appendChild(fontEl);
            });
        }

        // Populate effects
        function populateEffects() {
            effectsContainer.innerHTML = "";
            assets.effects.forEach((effect) => {
                const effectEl = document.createElement("div");
                effectEl.className = `drag-item asset-card p-3 border rounded-lg text-center cursor-move dark:border-gray-600 hover:border-primary-500`;
                effectEl.innerHTML = `
                    <div class="text-lg mb-1">${effect.name}</div>
                    <div class="text-xs text-gray-500 dark:text-gray-400 capitalize">${effect.type} • ${effect.intensity}</div>
                `;
                effectEl.draggable = true;
                effectEl.dataset.type = "effect";
                effectEl.dataset.value = effect.name;
                effectEl.dataset.id = effect.id;
                effectsContainer.appendChild(effectEl);
            });
        }

        // Populate colors
        function populateColors() {
            colorsContainer.innerHTML = "";
            assets.colors.forEach((color) => {
                const colorEl = document.createElement("div");
                colorEl.className = `drag-item asset-card h-16 rounded-lg cursor-move ${color.bg} ${color.text} flex items-center justify-center shadow-sm hover:shadow-md`;
                colorEl.textContent = color.name;
                colorEl.draggable = true;
                colorEl.dataset.type = "color";
                colorEl.dataset.bg = color.bg;
                colorEl.dataset.text = color.text;
                colorEl.dataset.id = color.id;
                colorsContainer.appendChild(colorEl);
            });
        }

        // Update platform
        function updatePlatform(platform) {
            currentDesign.platform = platform;

            // Update active tab
            platformTabs.forEach((tab) => {
                tab.classList.toggle(
                    "active",
                    tab.dataset.platform === platform
                );
            });

            // Update the aspect ratio of preview container
            const ratio = assets.platforms[platform].aspectRatio;
            const container = document.getElementById("preview-container");
            container.style.aspectRatio = ratio;

            // Wait a tiny bit for the container to resize, then resize the canvas
            setTimeout(() => {
                resizeCanvasToPlatform();
            }, 100);

            updateEngagementScore();
        }
        function resizeCanvasToPlatform() {
            const container = document.getElementById("preview-container");
            container.style.aspectRatio = ratio;

            let width = container.clientWidth;
            let height = container.clientHeight;

            if (myp5 && myp5.resizeCanvas) {
                myp5.resizeCanvas(width, height);

                // Update center point
                myp5.textX = width / 2;
                myp5.textY = height / 2;

                // Dynamically adjust font size based on new canvas height
                let newFontSize = Math.min(width, height) * 0.08;
                myp5.fontSize = newFontSize;

                if (myp5.bgGraphics) {
                    myp5.bgGraphics = myp5.createGraphics(width, height);
                    updateCanvasBackground();
                }
            }
        }

        // Update canvas size based on platform
        function updateCanvasSize() {
            try {
                const ratio =
                    assets.platforms[currentDesign.platform].aspectRatio;
                const container =
                    document.getElementById("preview-container");
                container.style.aspectRatio = ratio;

                // Resize p5 canvas
                setTimeout(() => {
                    let width = container.clientWidth;
                    let height = container.clientHeight;
                    myp5.resizeCanvas(width, height);
                    myp5.textX = width / 2;
                    myp5.textY = height / 2;

                    // Resize background graphics
                    myp5.bgGraphics = myp5.createGraphics(width, height);
                    updateCanvasBackground();
                    console.debug(`Canvas resized: ${width}x${height}`);
                }, 100);
            } catch (e) {
                console.error(`Failed to update canvas size: ${e.message}`);
            }
        }

        // Update canvas background
        function updateCanvasBackground() {
            myp5.updateCanvasBackground();
        }

        // Get color value from Tailwind class
        function getColorValue(tailwindClass) {
            const colorMap = {
                "bg-gray-900": "#111827",
                "bg-white": "#FFFFFF",
                "text-white": "#FFFFFF",
                "text-gray-900": "#111827",
            };
            return colorMap[tailwindClass] || "#FFFFFF";
        }

        // Update character count
        function updateCharCount() {
            const count = textContent.value.length;
            charCount.textContent = `${count}/120`;

            if (count > 100) {
                charCount.classList.add("text-yellow-500");
                charCount.classList.remove("text-gray-500", "text-red-500");
            } else if (count > 120) {
                charCount.classList.add("text-red-500");
                charCount.classList.remove(
                    "text-gray-500",
                    "text-yellow-500"
                );
            } else {
                charCount.classList.add("text-gray-500");
                charCount.classList.remove(
                    "text-yellow-500",
                    "text-red-500"
                );
            }
        }

        // Update design text
        function updateDesignText() {
            currentDesign.text = textContent.value || "Your Text Here";
            myp5.resetAnimation();
            updateEngagementScore();
            console.debug(`Text updated to '${currentDesign.text}'`);
        }

        // Toggle animation playback
        function togglePlayback() {
            const isPlaying = myp5.togglePlayback();

            if (isPlaying) {
                playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
                playPauseBtn.setAttribute("aria-label", "Pause animation");
            } else {
                playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
                playPauseBtn.setAttribute("aria-label", "Play animation");
            }
        }

        // Reset animation
        function resetAnimation() {
            myp5.resetAnimation();
        }

        // Save design to localStorage
        function saveDesign() {
            let designs =
                JSON.parse(localStorage.getItem("kineticDesigns")) || [];

            // Create a unique ID for this design
            const designId = Date.now().toString();
            const designToSave = {
                id: designId,
                ...currentDesign,
                timestamp: new Date().toISOString(),
            };

            designs.push(designToSave);
            localStorage.setItem("kineticDesigns", JSON.stringify(designs));

            // Update saved designs list
            loadSavedDesigns();

            // Show feedback
            showToast("Design saved successfully!", "success");
        }

        // Load saved designs
        function loadSavedDesigns() {
            const designs =
                JSON.parse(localStorage.getItem("kineticDesigns")) || [];
            savedDesigns.innerHTML = "";

            if (designs.length === 0) {
                savedDesigns.innerHTML = `
                    <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 text-center">
                        <i class="fas fa-folder-open text-gray-400 text-2xl mb-2"></i>
                        <p class="text-gray-500 dark:text-gray-400 text-sm">No saved designs yet</p>
                    </div>
                `;
                clearSavedBtn.style.display = "none";
                return;
            }

            clearSavedBtn.style.display = "block";

            // Sort by most recent first
            designs.sort(
                (a, b) => new Date(b.timestamp) - new Date(a.timestamp)
            );

            designs.forEach((design) => {
                const designEl = document.createElement("div");
                designEl.className =
                    "bg-gray-50 dark:bg-gray-700 rounded-lg p-4 flex justify-between items-center";

                const previewContent = document.createElement("div");
                previewContent.className = "flex items-center";

                // Create mini preview
                const preview = document.createElement("div");
                preview.className = "w-10 h-10 rounded mr-3 flex-shrink-0";

                // Apply background color
                if (design.bgColor.includes("gradient")) {
                    const gradientColors = design.bgColor.match(
                        /from-(.*?) to-(.*?)( |$)/
                    );
                    if (gradientColors) {
                        const fromColor = gradientColors[1].split("-")[0];
                        const toColor = gradientColors[2].split("-")[0];
                        preview.style.background = `linear-gradient(135deg, var(--tw-${fromColor}-500), var(--tw-${toColor}-500))`;
                    }
                } else {
                    preview.className += ` ${design.bgColor}`;
                }

                const textInfo = document.createElement("div");
                textInfo.className = "overflow-hidden";

                const previewText = document.createElement("div");
                previewText.className = "truncate font-medium";
                previewText.textContent =
                    design.text.split("\n")[0] || "Untitled";

                const previewMeta = document.createElement("div");
                previewMeta.className =
                    "text-xs text-gray-500 dark:text-gray-400 truncate";
                previewMeta.textContent = `${design.effect.charAt(0).toUpperCase() +
                    design.effect.slice(1)
                    } • ${new Date(design.timestamp).toLocaleDateString()}`;

                textInfo.appendChild(previewText);
                textInfo.appendChild(previewMeta);
                previewContent.appendChild(preview);
                previewContent.appendChild(textInfo);

                const actions = document.createElement("div");
                actions.className = "flex space-x-2";

                const loadBtn = document.createElement("button");
                loadBtn.className =
                    "p-2 text-primary-500 hover:text-primary-600 rounded-full hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors";
                loadBtn.innerHTML = '<i class="fas fa-upload"></i>';
                loadBtn.addEventListener("click", () => loadDesign(design));
                loadBtn.setAttribute("aria-label", "Load design");

                const deleteBtn = document.createElement("button");
                deleteBtn.className =
                    "p-2 text-red-500 hover:text-red-600 rounded-full hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors";
                deleteBtn.innerHTML = '<i class="fas fa-trash-alt"></i>';
                deleteBtn.addEventListener("click", () =>
                    deleteDesign(design.id)
                );
                deleteBtn.setAttribute("aria-label", "Delete design");

                actions.appendChild(loadBtn);
                actions.appendChild(deleteBtn);

                designEl.appendChild(previewContent);
                designEl.appendChild(actions);

                savedDesigns.appendChild(designEl);
            });
        }

        // Load a saved design
        function loadDesign(design) {
            currentDesign = {
                ...design,
                animationParams: {},
            };

            // Update UI
            updatePlatform(design.platform);
            textContent.value = design.text;
            updateCharCount();

            // Reset animation
            myp5.resetAnimation();

            // Show feedback
            showToast("Design loaded!", "success");
        }

        // Delete a saved design
        function deleteDesign(id) {
            if (confirm("Are you sure you want to delete this design?")) {
                let designs =
                    JSON.parse(localStorage.getItem("kineticDesigns")) ||
                    [];
                designs = designs.filter((d) => d.id !== id);
                localStorage.setItem(
                    "kineticDesigns",
                    JSON.stringify(designs)
                );
                loadSavedDesigns();

                showToast("Design deleted", "info");
            }
        }

        // Clear all saved designs
        function clearAllSavedDesigns() {
            if (
                confirm(
                    "Are you sure you want to delete ALL saved designs? This cannot be undone."
                )
            ) {
                localStorage.removeItem("kineticDesigns");
                loadSavedDesigns();

                showToast("All designs cleared", "info");
            }
        }

        // Clear current design
        function clearDesign() {
            if (
                confirm(
                    "Are you sure you want to clear the current design?"
                )
            ) {
                currentDesign = {
                    platform: "instagram",
                    text: "Create Amazing\nTypography!",
                    font: 'bold 48px "Poppins", sans-serif',
                    effect: "bounce",
                    bgColor: "bg-gradient-to-r from-pink-500 to-yellow-500",
                    textColor: "text-white",
                    animationParams: {},
                };

                // Update UI
                updatePlatform(currentDesign.platform);
                textContent.value = currentDesign.text;
                updateCharCount();

                // Reset animation
                myp5.resetAnimation();

                showToast("Design cleared", "info");
            }
        }

        // Export as GIF
        function exportAsGif() {
            showToast(
                "Preparing GIF export... (this would use gif.js in a real implementation)",
                "info"
            );
            // In a real implementation, we would:
            // 1. Capture frames from the p5.js canvas
            // 2. Use gif.js to compile them into a GIF
            // 3. Offer download to the user
        }

        // Toggle dark mode
        function toggleDarkMode() {
            if (document.documentElement.classList.contains("dark")) {
                enableLightMode();
            } else {
                enableDarkMode();
            }
        }

        function enableDarkMode() {
            document.documentElement.classList.add("dark");
            themeIcon.classList.remove("fa-sun");
            themeIcon.classList.add("fa-moon");
            localStorage.setItem("darkMode", "true");
        }

        function enableLightMode() {
            document.documentElement.classList.remove("dark");
            themeIcon.classList.remove("fa-moon");
            themeIcon.classList.add("fa-sun");
            localStorage.setItem("darkMode", "false");
        }

        // Apply trending style
        function applyTrendingStyle() {
            // Glitch effect with neon colors
            currentDesign.effect = "glitch";
            currentDesign.bgColor =
                "bg-gradient-to-r from-green-400 to-blue-500";
            currentDesign.textColor = "text-white";

            // Update UI
            updateCanvasBackground();
            updateEngagementScore();

            showToast("Trending style applied: Neon Glitch!", "success");
        }

        // Randomize font
        function randomizeFont() {
            const randomFont =
                assets.fonts[
                Math.floor(Math.random() * assets.fonts.length)
                ];
            currentDesign.font = randomFont.value;
            updateEngagementScore();

            showToast(`Random font applied: ${randomFont.name}`, "info");
        }

        // Randomize effect
        function randomizeEffect() {
            const randomEffect =
                assets.effects[
                Math.floor(Math.random() * assets.effects.length)
                ];
            currentDesign.effect = randomEffect.name
                .toLowerCase()
                .replace(" ", "-");
            myp5.resetAnimation();
            updateEngagementScore();

            showToast(
                `Random effect applied: ${randomEffect.name}`,
                "info"
            );
        }

        // Randomize color
        function randomizeColor() {
            const randomColor =
                assets.colors[
                Math.floor(Math.random() * assets.colors.length)
                ];
            currentDesign.bgColor = randomColor.bg;
            currentDesign.textColor = randomColor.text;
            updateCanvasBackground();
            updateEngagementScore();

            showToast(`Random color applied: ${randomColor.name}`, "info");
        }

        // Update engagement score
        function updateEngagementScore() {
            const platformData = assets.platforms[currentDesign.platform];

            // Calculate fluidity score based on effect complexity
            const fluidityScores = {
                bounce: 70,
                "fade-in": 60,
                spin: 80,
                wave: 85,
                typewriter: 75,
                glitch: 90,
                float: 65,
                pulse: 70,
            };
            const fluidity = fluidityScores[currentDesign.effect] || 50;

            // Calculate visual impact based on color contrast and text length
            let impact = 50;
            if (currentDesign.bgColor.includes("gradient")) impact += 20;
            if (
                currentDesign.textColor === "text-white" &&
                currentDesign.bgColor.includes("900")
            )
                impact += 15;
            impact = Math.min(impact + currentDesign.text.length / 5, 100);

            // Calculate platform fit
            let platformFit = 50;

            // Check font category
            const currentFont = assets.fonts.find(
                (f) => f.value === currentDesign.font
            );
            if (
                currentFont &&
                platformData.idealFonts.includes(currentFont.category)
            ) {
                platformFit += 15;
            }

            // Check effect
            const effectName = currentDesign.effect
                .split("-")
                .map((word) => word.charAt(0).toUpperCase() + word.slice(1))
                .join(" ");

            if (platformData.idealEffects.includes(effectName)) {
                platformFit += 20;
            }

            // Check color mood
            const currentColor = assets.colors.find(
                (c) => c.bg === currentDesign.bgColor
            );
            if (
                currentColor &&
                platformData.idealColors.includes(currentColor.mood)
            ) {
                platformFit += 15;
            }

            // Check text length
            if (
                Math.abs(
                    currentDesign.text.length - platformData.idealTextLength
                ) < 20
            ) {
                platformFit += 10;
            }

            // Ensure scores are within bounds
            platformFit = Math.min(Math.max(platformFit, 0), 100);

            // Update score displays with animation
            animateScore("fluidity-score", fluidity);
            animateScore("impact-score", Math.round(impact));
            animateScore("platform-score", Math.round(platformFit));

            // Animate progress bars
            animateProgressBar("fluidity-bar", fluidity);
            animateProgressBar("impact-bar", Math.round(impact));
            animateProgressBar("platform-bar", Math.round(platformFit));

            // Calculate total score (weighted average)
            const total = Math.round(
                fluidity * 0.4 + impact * 0.3 + platformFit * 0.3
            );
            animateScore("total-score", total);

            // Animate progress ring
            const offset = circumference - (total / 100) * circumference;
            progressRing.style.strokeDashoffset = offset;

            // Provide feedback
            let feedback = "";
            if (total > 85) {
                feedback =
                    "Excellent! This animation will likely perform very well.";
            } else if (total > 70) {
                feedback =
                    "Great job! This is a strong design that should engage viewers.";
            } else if (total > 50) {
                feedback =
                    "Good start. Consider tweaking effects or colors for better impact.";
            } else {
                feedback =
                    "Keep working! Try different effects and color combinations.";
            }
            scoreFeedback.textContent = feedback;
        }

        // Animate score display
        function animateScore(elementId, targetValue) {
            const element = document.getElementById(elementId);
            const current = parseInt(element.textContent) || 0;
            const increment = targetValue > current ? 1 : -1;

            let currentValue = current;
            const timer = setInterval(() => {
                currentValue += increment;
                element.textContent = currentValue;

                if (
                    (increment === 1 && currentValue >= targetValue) ||
                    (increment === -1 && currentValue <= targetValue)
                ) {
                    clearInterval(timer);
                    element.textContent = targetValue;
                }
            }, 10);
        }

        // Animate progress bar
        function animateProgressBar(elementId, targetPercentage) {
            const element = document.getElementById(elementId);
            const currentWidth = parseInt(element.style.width) || 0;
            const increment = targetPercentage > currentWidth ? 1 : -1;

            let currentValue = currentWidth;
            const timer = setInterval(() => {
                currentValue += increment;
                element.style.width = `${currentValue}%`;

                if (
                    (increment === 1 && currentValue >= targetPercentage) ||
                    (increment === -1 && currentValue <= targetPercentage)
                ) {
                    clearInterval(timer);
                    element.style.width = `${targetPercentage}%`;
                }
            }, 10);
        }

        // Show tutorial
        // Show tutorial
        function showTutorial() {
            tutorialModal.classList.remove(
                "opacity-0",
                "pointer-events-none"
            );
            tutorialModal.classList.add(
                "opacity-100",
                "pointer-events-auto"
            );
            tutorialModal
                .querySelector("div.transform")
                .classList.remove("scale-95");
            tutorialModal
                .querySelector("div.transform")
                .classList.add("scale-100");
            console.debug("Tutorial modal shown");
        }

        // Hide tutorial
        function hideTutorial() {
            tutorialModal.classList.remove(
                "opacity-100",
                "pointer-events-auto"
            );
            tutorialModal.classList.add("opacity-0", "pointer-events-none");
            tutorialModal
                .querySelector("div.transform")
                .classList.remove("scale-100");
            tutorialModal
                .querySelector("div.transform")
                .classList.add("scale-95");
            console.debug("Tutorial modal hidden");
        }

        // Show toast notification
        function showToast(message, type) {
            const toast = document.createElement("div");
            const typeStyles = {
                success: "bg-green-500 text-white",
                info: "bg-blue-500 text-white",
                warning: "bg-yellow-500 text-gray-900",
                error: "bg-red-500 text-white",
            };

            toast.className = `flex items-center p-4 rounded-lg shadow-lg transition-all duration-300 transform translate-y-4 opacity-0 ${typeStyles[type] || typeStyles.info
                }`;
            toast.innerHTML = `
                    <i class="fas fa-${type === "success"
                    ? "check-circle"
                    : type === "error"
                        ? "exclamation-circle"
                        : "info-circle"
                } mr-2"></i>
                    <span>${message}</span>
                `;

            const toastContainer =
                document.getElementById("toast-container");
            toastContainer.appendChild(toast);

            // Animate in
            setTimeout(() => {
                toast.classList.remove("translate-y-4", "opacity-0");
                toast.classList.add("translate-y-0", "opacity-100");
            }, 100);

            // Animate out and remove
            setTimeout(() => {
                toast.classList.remove("translate-y-0", "opacity-100");
                toast.classList.add("translate-y-4", "opacity-0");
                setTimeout(() => {
                    toast.remove();
                }, 300);
            }, 3000);

            console.debug(`Toast shown: ${message} (Type: ${type})`);
        }

        // Initialize the app on load
        document.addEventListener("DOMContentLoaded", initApp);
    </script>
</body>

</html>